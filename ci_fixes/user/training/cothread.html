
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Training: Channel Access with cothread &#8212; cothread 2.20.1.dev6+g468e617 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=bb03dde2"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/training/cothread';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://DiamondLightSource.github.io/cothread/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'ci_fixes';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../../_static/dls-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Developer Guide" href="../../developer/index.html" />
    <link rel="prev" title="Using the catools Library" href="../catools.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="ci_fixes" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/dls-logo.svg" class="logo__image only-light" alt=""/>
    <img src="../../_static/dls-logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">cothread</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developer/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/DiamondLightSource/cothread/releases">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/cothread" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/cothread" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../developer/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/DiamondLightSource/cothread/releases">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DiamondLightSource/cothread" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/cothread" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cothread.html">Using the cothread Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../catools.html">Using the catools Library</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Training: Channel Access with <code class="docutils literal notranslate"><span class="pre">cothread</span></code></a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Training: Channel Access with <code class="docutils literal notranslate"><span class="pre">cothread</span></code></span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="training-channel-access-with-cothread">
<h1>Training: Channel Access with <code class="docutils literal notranslate"><span class="pre">cothread</span></code><a class="headerlink" href="#training-channel-access-with-cothread" title="Link to this heading">#</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Michael Abbott</p>
</dd>
</dl>
<dl>
<dt>Documentation:</dt><dd><p><a class="reference external" href="file:///dls_sw/prod/common/python/RHEL6-x86_64/cothread/2-15/docs/html/index.html">file:///dls_sw/prod/common/python/RHEL6-x86_64/cothread/2-15/docs/html/index.html</a></p>
<p><a class="reference external" href="https://cothread.readthedocs.io">https://cothread.readthedocs.io</a></p>
</dd>
<dt>Sources:</dt><dd><p><a class="reference external" href="file:///dls_sw/prod/common/python/RHEL6-x86_64/cothread/2-15">file:///dls_sw/prod/common/python/RHEL6-x86_64/cothread/2-15</a>
<a class="github reference external" href="https://github.com/dls-controls/cothread">dls-controls/cothread</a></p>
</dd>
<dt>Development version:</dt><dd><p><a class="reference external" href="file:///home/mga83/epics/cothread">file:///home/mga83/epics/cothread</a></p>
</dd>
</dl>
<section id="cothread">
<h2>Cothread<a class="headerlink" href="#cothread" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cothread</span></code> library provides EPICS “Channel Access” bindings for Python.
The library comprises two parts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cothread</span></code> itself: “cooperative threads”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cothread.catools</span></code> provides channel access bindings.</p></li>
</ul>
<p>Because EPICS involves communication with other machines events may happen at
any time.  The <code class="docutils literal notranslate"><span class="pre">cothread</span></code> library provides a mechanism for managing these
updates with the minimum of interference with the rest of the program.</p>
</section>
<section id="cothread-catools-bindings">
<h2>Cothread catools bindings<a class="headerlink" href="#cothread-catools-bindings" title="Link to this heading">#</a></h2>
<p>The EPICS Channel Access Python interface consists of three functions:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">caget(pvs,</span> <span class="pre">...)</span></code></dt><dd><p>Retrieves value from a single PV or a list of PVs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">caput(pvs,</span> <span class="pre">values,</span> <span class="pre">...)</span></code></dt><dd><p>Writes value or values to a single PV or list of PVs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">camonitor(pvs,</span> <span class="pre">callback,</span> <span class="pre">...)</span></code></dt><dd><p>Creates “subscription” with updates every time a PV changes: <code class="docutils literal notranslate"><span class="pre">callback</span></code> is
called with a new value every time any listed PV updates.</p>
</dd>
</dl>
</section>
<section id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Link to this heading">#</a></h2>
<p>Need to import <code class="docutils literal notranslate"><span class="pre">cothread</span></code>, all of the examples will start with
the following code, 2.15 is the current release:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pkg_resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">require</span>
<span class="n">require</span><span class="p">(</span><span class="s1">&#39;cothread==2.15&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cothread</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cothread.catools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Channel access waveform data is returned as <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays, so it will be
convenient to include this in our list of imports:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
</pre></div>
</div>
</section>
<section id="example-printing-a-pv">
<h2>Example: Printing a PV<a class="headerlink" href="#example-printing-a-pv" title="Link to this heading">#</a></h2>
<p>Calling <code class="docutils literal notranslate"><span class="pre">caget</span></code> with a PV name returns the value of the PV.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">caget</span></code> with a list of PV names returns a list of PV values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bpms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SR</span><span class="si">%02d</span><span class="s1">C-DI-EBPM-</span><span class="si">%02d</span><span class="s1">:SA:X&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="n">sax</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="n">bpms</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">sax</span>
</pre></div>
</div>
<p>Note that calling <code class="docutils literal notranslate"><span class="pre">caget</span></code> with a long list is potentially <em>much</em> faster than
calling <code class="docutils literal notranslate"><span class="pre">caget</span></code> on each element of the list in turn, as passing a list to
<code class="docutils literal notranslate"><span class="pre">caget</span></code> allows all fetches to proceed concurrently.</p>
</section>
<section id="testing-speed-of-caget">
<h2>Testing Speed of <code class="docutils literal notranslate"><span class="pre">caget</span></code><a class="headerlink" href="#testing-speed-of-caget" title="Link to this heading">#</a></h2>
<p>Compare:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">();</span> <span class="n">caget</span><span class="p">(</span><span class="n">bpms</span><span class="p">);</span> <span class="nb">print</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">();</span> <span class="p">[</span><span class="n">caget</span><span class="p">(</span><span class="n">bpm</span><span class="p">)</span> <span class="k">for</span> <span class="n">bpm</span> <span class="ow">in</span> <span class="n">bpms</span><span class="p">];</span> <span class="nb">print</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</pre></div>
</div>
<p>I tend to get a difference of a factor of around 50 between these two tests.</p>
</section>
<section id="exercise-timing-test">
<h2>Exercise: Timing test<a class="headerlink" href="#exercise-timing-test" title="Link to this heading">#</a></h2>
<p>Exercise: put everything in a file and run this test standalone.  Try adding
more PVs and making the test controlled by a command line parameter.</p>
</section>
<section id="shape-polymorphism">
<h2>Shape Polymorphism<a class="headerlink" href="#shape-polymorphism" title="Link to this heading">#</a></h2>
<p>As we’ve already seen, the behaviour of the three channel access functions
varies depending on whether the first argument is a string or a list of strings,
for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">caget</span><span class="p">([</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">,</span> <span class="s1">&#39;SR-DI-DCCT-01:LIFETIME&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Similarly <code class="docutils literal notranslate"><span class="pre">caput</span></code> can write to multiple pvs, in which case a single value or a
list of values can be passed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">caput</span><span class="p">([</span><span class="s1">&#39;TEST:PV1&#39;</span><span class="p">,</span> <span class="s1">&#39;TEST:PV2&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>              <span class="c1"># Writes 3 to both</span>
<span class="n">caput</span><span class="p">([</span><span class="s1">&#39;TEST:PV1&#39;</span><span class="p">,</span> <span class="s1">&#39;TEST:S&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;testing&#39;</span><span class="p">])</span>  <span class="c1"># Writes different values</span>

<span class="c1"># To write a repeated array to multiple TEST:PVs need to use repeat_value</span>
<span class="n">caput</span><span class="p">([</span><span class="s1">&#39;TEST:WF1&#39;</span><span class="p">,</span> <span class="s1">&#39;TEST:WF2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">repeat_value</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="incremental docutils container">
<p>Note: this is the <em>only</em> case where <code class="docutils literal notranslate"><span class="pre">repeat_value=True</span></code> is needed.</p>
</div>
</section>
<section id="example-monitoring-a-pv">
<h2>Example: Monitoring a PV<a class="headerlink" href="#example-monitoring-a-pv" title="Link to this heading">#</a></h2>
<p>Updates to a PV result in a callback function being called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_update</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">camonitor</span><span class="p">(</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">,</span> <span class="n">print_update</span><span class="p">)</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Updates arrive in the background until we close the monitor, but for normal
applications we leave the monitor open until the application exits.</p>
</section>
<section id="camonitor-for-lists-of-pvs">
<h2><code class="docutils literal notranslate"><span class="pre">camonitor</span></code> for Lists of PVs<a class="headerlink" href="#camonitor-for-lists-of-pvs" title="Link to this heading">#</a></h2>
<p>If <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> is passed a list of PVs it expects the update function to take
a second argument which is used as an index.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_update</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span>

<span class="n">mm</span> <span class="o">=</span> <span class="n">camonitor</span><span class="p">(</span><span class="n">bpms</span><span class="p">,</span> <span class="n">print_update</span><span class="p">)</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mm</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="incremental docutils container">
<p>If the index is not needed there is no particular benefit to calling
<code class="docutils literal notranslate"><span class="pre">camonitor</span></code> on lists of PVs, unlike for <code class="docutils literal notranslate"><span class="pre">caget</span></code> and (it depends)
<code class="docutils literal notranslate"><span class="pre">caput</span></code>.</p>
</div>
</section>
<section id="exercise-camonitor-and-caput">
<h2>Exercise: <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code><a class="headerlink" href="#exercise-camonitor-and-caput" title="Link to this heading">#</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code> to monitor <code class="docutils literal notranslate"><span class="pre">TEST:PV1</span></code> and add 1 to it after a
couple of seconds.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">cothread.Sleep(...)</span></code> for sleeping.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don’t use <code class="docutils literal notranslate"><span class="pre">time.sleep(...)</span></code> when using cothread: this will prevent updates
from taking place!</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">cothread.WaitForQuit()</span></code> at the end of your script if there’s nothing else
to do while cothread does its work.</p>
</section>
<section id="a-note-on-the-last-exercise">
<h2>A note on the last exercise<a class="headerlink" href="#a-note-on-the-last-exercise" title="Link to this heading">#</a></h2>
<p>The obvious answer is to call <code class="docutils literal notranslate"><span class="pre">cothread.Sleep</span></code> in the camonitor callback
function, eg:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">do_update</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">caput</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">camonitor</span><span class="p">(</span><span class="s1">&#39;TEST:PV1&#39;</span><span class="p">,</span> <span class="n">do_update</span><span class="p">)</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Unfortunately doing this has the unfortunate side effect of blocking
all other camonitor updates during the <code class="docutils literal notranslate"><span class="pre">Sleep</span></code>.</p>
<p>Only one camonitor callback function is processed at a time.  If you need to do
long lasting work in response to a PV update, push the processing somewhere else
with <code class="docutils literal notranslate"><span class="pre">Spawn</span></code> or <code class="docutils literal notranslate"><span class="pre">Event</span></code>.</p>
</section>
<section id="augmented-values">
<h2>Augmented Values<a class="headerlink" href="#augmented-values" title="Link to this heading">#</a></h2>
<p>Values returned by <code class="docutils literal notranslate"><span class="pre">caget</span></code> and delivered by <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> are “augmented” by
extra information.  The following two fields are always present:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">.name</span></code></dt><dd><p>Contains the full name of the requested PV.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.ok</span></code></dt><dd><p>Will be <code class="docutils literal notranslate"><span class="pre">True</span></code> for values fetched without trouble, <code class="docutils literal notranslate"><span class="pre">False</span></code> if value is
not really a value!</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="n">v</span>
</pre></div>
</div>
</section>
<section id="augmented-values-are-ordinary">
<h2>Augmented Values are Ordinary<a class="headerlink" href="#augmented-values-are-ordinary" title="Link to this heading">#</a></h2>
<p>Note that <code class="docutils literal notranslate"><span class="pre">v</span></code> (from above) is an ordinary number:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>However, it’s not completely ordinary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<div class="incremental docutils container">
<p>It will behave just like an ordinary float, but can be made completely
ordinary with the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="o">+</span><span class="n">v</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="o">+</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>However you should not normally need to use this!</p>
</div>
</section>
<section id="getting-values-with-timestamps">
<h2>Getting Values with Timestamps<a class="headerlink" href="#getting-values-with-timestamps" title="Link to this heading">#</a></h2>
<p>It is possible to get timestamp information with a retrieved or monitored PV,
but it needs to be requested:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">FORMAT_TIME</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">datetime</span>
</pre></div>
</div>
<p>The timestamp is also available in raw Unix format (seconds since 1970):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">timestamp</span>
</pre></div>
</div>
</section>
<section id="example-gathering-updates">
<h2>Example: Gathering Updates<a class="headerlink" href="#example-gathering-updates" title="Link to this heading">#</a></h2>
<p>We’ll monitor a requested number of updates and gather them into a list.  For
this example the state is held in the local variables of the <code class="docutils literal notranslate"><span class="pre">gather</span></code>
function: note the use of a nested function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gather</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">done</span> <span class="o">=</span> <span class="n">cothread</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">done</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">camonitor</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
    <span class="n">done</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">values</span>

<span class="nb">print</span> <span class="n">gather</span><span class="p">(</span><span class="s1">&#39;SR21C-DI-DCCT-01:SIGNAL&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-circular-updates-buffer">
<h2>Example: Circular Updates Buffer<a class="headerlink" href="#example-circular-updates-buffer" title="Link to this heading">#</a></h2>
<p>Let’s try a different version with a circular buffer.  In this case we need a
class because the buffer will remain in existence for longer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Gather</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inptr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">camonitor</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inptr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inptr</span><span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">inptr</span><span class="p">]</span>

<span class="n">buf</span> <span class="o">=</span> <span class="n">Gather</span><span class="p">(</span><span class="s1">&#39;SR21C-DI-DCCT-01:SIGNAL&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">buf</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">buf</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>This buffer can now safely be left running and will at any time return the last
<code class="docutils literal notranslate"><span class="pre">count</span></code> values received.</p>
</section>
<section id="example-gathering-arrays">
<h2>Example: Gathering Arrays<a class="headerlink" href="#example-gathering-arrays" title="Link to this heading">#</a></h2>
<p>Working with <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays can be much more efficient than working with
Python lists of values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">caget</span><span class="p">(</span><span class="n">bpms</span><span class="p">))</span>
<span class="nb">print</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>However, when it matters, timestamp information and other extended attributes
are lost when gathering values into arrays, so if the timestamps are needed a
little more care is required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawx</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="n">bpms</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">FORMAT_TIME</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rawx</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rawx</span><span class="p">])</span>
<span class="nb">print</span> <span class="n">tx</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">tx</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>   <span class="c1"># Check spread of timestamps</span>
</pre></div>
</div>
</section>
<section id="example-default-error-handling">
<h2>Example: Default Error Handling<a class="headerlink" href="#example-default-error-handling" title="Link to this heading">#</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">caget</span></code> we only really need to worry about fetching PVs that don’t exist,
for <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> we may also need to pay attention to PVs becoming
disconnected.  The default behaviour of <code class="docutils literal notranslate"><span class="pre">cothread</span></code> produces sensible results,
but this can be overridden.</p>
<p>This behaviour of raising an exception when <code class="docutils literal notranslate"><span class="pre">caget</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code> fails is the
best default behaviour, because in routine naive use if a PV is unavailable then
this is an unrecoverable error.  However, this isn’t always what we want.</p>
</section>
<section id="adjusting-the-timeout">
<h2>Adjusting the Timeout<a class="headerlink" href="#adjusting-the-timeout" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">caget</span><span class="p">(</span><span class="s1">&#39;bogus&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This raises an exception after five seconds.  The timeout can be adjusted with
an explicit argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">caget</span><span class="p">(</span><span class="s1">&#39;bogus&#39;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, when fetching very large numbers of PVs through the gateway it
can happen that the default five second timeout isn’t long enough.</p>
</section>
<section id="catching-errors-from-caget">
<h2>Catching Errors from <code class="docutils literal notranslate"><span class="pre">caget</span></code><a class="headerlink" href="#catching-errors-from-caget" title="Link to this heading">#</a></h2>
<p>We can ask <code class="docutils literal notranslate"><span class="pre">caget</span></code> to return an error value instead of raising an exception:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">caget</span><span class="p">([</span><span class="s1">&#39;bogus&#39;</span><span class="p">,</span> <span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">],</span> <span class="n">throw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">v1</span><span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="n">v2</span><span class="o">.</span><span class="n">ok</span>
</pre></div>
</div>
<p>Note that if a pv is not <code class="docutils literal notranslate"><span class="pre">ok</span></code> we can’t test for things like timestamps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;bogus&#39;</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">FORMAT_TIME</span><span class="p">,</span> <span class="n">throw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ok</span>
<span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">datetime</span>
</pre></div>
</div>
<p>This raises an exception when trying to interrogate the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> field on a
PV that never arrived!</p>
</section>
<section id="catching-errors-from-caput">
<h2>Catching Errors from <code class="docutils literal notranslate"><span class="pre">caput</span></code><a class="headerlink" href="#catching-errors-from-caput" title="Link to this heading">#</a></h2>
<p>The same applies to <code class="docutils literal notranslate"><span class="pre">caput</span></code>.  We’ll try writing to a PV we can write to, one
we can’t, and one that doesn’t exist:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pvs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TEST:PV1&#39;</span><span class="p">,</span> <span class="s1">&#39;bogus&#39;</span><span class="p">,</span> <span class="s1">&#39;SR-DI-DCCT-01:SIGNAL&#39;</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">caput</span><span class="p">(</span><span class="n">pvs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">throw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">ok</span>
    <span class="nb">print</span> <span class="n">result</span>
</pre></div>
</div>
<p>Note that a complete description of the error is in the failing results: in this
case each result is a catchable exception object with a descriptive error
message as its string representation.</p>
</section>
<section id="cothread-and-qt">
<h2>Cothread and Qt<a class="headerlink" href="#cothread-and-qt" title="Link to this heading">#</a></h2>
<p>The cothread library relies on cooperative transfer of control between
cothreads, and similarly Qt has its own mechanism of events and notifications.
For cothread and Qt to work together, these two libraries need to be introduced
to each other.</p>
<p>Fortunately this is easy.  Run:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cothread</span><span class="o">.</span><span class="n">iqt</span><span class="p">()</span>
</pre></div>
</div>
<p>It’s safest to run this before importing any Qt dependent libraries.</p>
<p>This function will create and return the Qt application object if you need it.</p>
</section>
<section id="plotting-preamble">
<h2>Plotting: Preamble<a class="headerlink" href="#plotting-preamble" title="Link to this heading">#</a></h2>
<p>A certain amount of boilerplate preamble is required to get interactive plotting
working with <code class="docutils literal notranslate"><span class="pre">dls-python</span></code>.  We’ll show the complete set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pkg_resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">require</span>
<span class="n">require</span><span class="p">(</span><span class="s1">&#39;cothread==2.15&#39;</span><span class="p">)</span>
<span class="n">require</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cothread</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cothread.catools</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="n">cothread</span><span class="o">.</span><span class="n">iqt</span><span class="p">()</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="plotting-an-example">
<h2>Plotting: An Example<a class="headerlink" href="#plotting-an-example" title="Link to this heading">#</a></h2>
<p>Now we can fetch and plot a waveform:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wfx</span> <span class="o">=</span> <span class="n">caget</span><span class="p">(</span><span class="s1">&#39;SR-DI-EBPM-01:SA:X&#39;</span><span class="p">)</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wfx</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s make it update continuously:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">update_ll</span><span class="p">(</span><span class="n">wfx</span><span class="p">):</span>
    <span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">wfx</span><span class="p">)</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">camonitor</span><span class="p">(</span><span class="s1">&#39;SR-DI-EBPM-01:SA:X&#39;</span><span class="p">,</span> <span class="n">update_ll</span><span class="p">)</span>
</pre></div>
</div>
<p>Exercise: Plot both X and Y on the same graph.  Hint: <code class="docutils literal notranslate"><span class="pre">SR-DI-EBPM-01:BPMID</span></code>
contains a good x-axis.</p>
</section>
<section id="advanced-topics">
<h2>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">#</a></h2>
</section>
<section id="advanced-topic-cothreads">
<h2>Advanced Topic: Cothreads<a class="headerlink" href="#advanced-topic-cothreads" title="Link to this heading">#</a></h2>
<p>We’ve already seen cothreads: <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> callbacks occur “in the background”,
really they occur on a dedicated cothread.</p>
<p>Cothreads are <em>cooperative</em> “threads”, which means a cothread will run until it
deliberately relinquishes control.  This has advantages and disadvantages:</p>
<dl class="simple">
<dt>Advantage</dt><dd><p>No locking is required, a cothread will not run when it’s not expected.</p>
</dd>
<dt>Disadvantage</dt><dd><p>A cothread that won’t relinquish control will block all other cothreads.</p>
</dd>
</dl>
<p>Note that Python can’t make use of multiple cores.</p>
</section>
<section id="creating-a-cothread">
<h2>Creating a Cothread<a class="headerlink" href="#creating-a-cothread" title="Link to this heading">#</a></h2>
<p>Creating a cothread is very easy: just define the function to run in the
cothread and call <code class="docutils literal notranslate"><span class="pre">cothread.Spawn</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">def</span><span class="w"> </span><span class="nf">background</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">running</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Hello from&#39;</span><span class="p">,</span> <span class="n">name</span>
        <span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>

<span class="n">cothread</span><span class="o">.</span><span class="n">Spawn</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="s1">&#39;test1&#39;</span><span class="p">)</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Spawn</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="n">sleep</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="communicating-with-cothreads">
<h2>Communicating with Cothreads<a class="headerlink" href="#communicating-with-cothreads" title="Link to this heading">#</a></h2>
<p>Communicate using event objects and queues:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cothread.Event()</span></code></dt><dd><p>Creates an event object which is either ready or not ready.  When it’s ready
it has a value.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cothread.EventQueue()</span></code></dt><dd><p>Almost exactly like an event object, but multiple values can be waiting.</p>
</dd>
</dl>
<p>Both objects support two methods:</p>
<dl class="simple">
<dt>event<code class="docutils literal notranslate"><span class="pre">.Signal(value)</span></code></dt><dd><p>Makes event object ready with given value.</p>
</dd>
<dt>event<code class="docutils literal notranslate"><span class="pre">.Wait(timeout=None)</span></code></dt><dd><p>Suspends cothread until object is ready, consumes and returns value.</p>
</dd>
</dl>
</section>
<section id="example-using-event">
<h2>Example: Using <code class="docutils literal notranslate"><span class="pre">Event</span></code><a class="headerlink" href="#example-using-event" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PV</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">cothread</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="n">camonitor</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__on_update</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">FORMAT_TIME</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__on_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">pv</span> <span class="o">=</span> <span class="n">PV</span><span class="p">(</span><span class="s1">&#39;SR21C-DI-DCCT-01:SIGNAL&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="nb">print</span> <span class="n">v</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we always get the latest value, even though the PV updates at 5Hz.</p>
<p>Cothread already implements a fuller featured version of this class available as
<code class="docutils literal notranslate"><span class="pre">cothread.pv.PV</span></code>, and another variant <code class="docutils literal notranslate"><span class="pre">cothread.pv.PV_array</span></code>.</p>
</section>
<section id="cothread-suspension-points">
<h2>Cothread Suspension Points<a class="headerlink" href="#cothread-suspension-points" title="Link to this heading">#</a></h2>
<p>The following functions are cothread suspension points (where control can be
yielded to another cothread):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Sleep()</span></code>, <code class="docutils literal notranslate"><span class="pre">SleepUntil()</span></code>, <code class="docutils literal notranslate"><span class="pre">Yield()</span></code></p></li>
<li><p>event<code class="docutils literal notranslate"><span class="pre">.Wait()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">caget()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">caput()</span></code> most of the time (see documentation to avoid suspension).</p></li>
</ul>
<p>The following cothread modules provide extra cothread aware suspension points,
see documentation for details:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cothread.coselect</span></code>: provides <code class="docutils literal notranslate"><span class="pre">select()</span></code> and <code class="docutils literal notranslate"><span class="pre">poll</span></code> functionality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cothread.cosocket</span></code>: provides cothread aware socket API.</p></li>
</ul>
</section>
<section id="cothreads-and-real-threads">
<h2>Cothreads and Real Threads<a class="headerlink" href="#cothreads-and-real-threads" title="Link to this heading">#</a></h2>
<p>Python threads are created with the <code class="docutils literal notranslate"><span class="pre">threading.Thread</span></code> class.  A Python thread
cannot safely call cothread methods … except for <code class="docutils literal notranslate"><span class="pre">cothread.Callback()</span></code>,
which arranges for its argument to be called in a cothread:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">callback_code</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;cothread tick&#39;</span><span class="p">,</span> <span class="n">n</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="k">def</span><span class="w"> </span><span class="nf">thread_code</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;thread tick&#39;</span><span class="p">,</span> <span class="n">n</span>
        <span class="n">cothread</span><span class="o">.</span><span class="n">Callback</span><span class="p">(</span><span class="n">callback_code</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">thread</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">thread_code</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,))</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="slightly-more-realistic-version">
<h2>Slightly more Realistic Version<a class="headerlink" href="#slightly-more-realistic-version" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">consumer</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s1">&#39;consumed&#39;</span><span class="p">,</span> <span class="n">n</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;thread tick&#39;</span><span class="p">,</span> <span class="n">n</span>
<span class="c1">#        event.Signal(n)</span>
        <span class="n">cothread</span><span class="o">.</span><span class="n">Callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">thread</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">cothread</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Spawn</span><span class="p">(</span><span class="n">consumer</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">producer</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">cothread</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Try replacing the <code class="docutils literal notranslate"><span class="pre">Callback</span></code> call with a direct <code class="docutils literal notranslate"><span class="pre">Signal</span></code> call and see what
happens.</p>
<p>Bonus question: what’s wrong with this?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cothread</span><span class="o">.</span><span class="n">Callback</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../catools.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Using the catools Library</p>
      </div>
    </a>
    <a class="right-next"
       href="../../developer/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Developer Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cothread">Cothread</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cothread-catools-bindings">Cothread catools bindings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminaries">Preliminaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-printing-a-pv">Example: Printing a PV</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-speed-of-caget">Testing Speed of <code class="docutils literal notranslate"><span class="pre">caget</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-timing-test">Exercise: Timing test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-polymorphism">Shape Polymorphism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-monitoring-a-pv">Example: Monitoring a PV</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#camonitor-for-lists-of-pvs"><code class="docutils literal notranslate"><span class="pre">camonitor</span></code> for Lists of PVs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-camonitor-and-caput">Exercise: <code class="docutils literal notranslate"><span class="pre">camonitor</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-the-last-exercise">A note on the last exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#augmented-values">Augmented Values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#augmented-values-are-ordinary">Augmented Values are Ordinary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-values-with-timestamps">Getting Values with Timestamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-gathering-updates">Example: Gathering Updates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-circular-updates-buffer">Example: Circular Updates Buffer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-gathering-arrays">Example: Gathering Arrays</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-default-error-handling">Example: Default Error Handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-the-timeout">Adjusting the Timeout</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catching-errors-from-caget">Catching Errors from <code class="docutils literal notranslate"><span class="pre">caget</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catching-errors-from-caput">Catching Errors from <code class="docutils literal notranslate"><span class="pre">caput</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cothread-and-qt">Cothread and Qt</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-preamble">Plotting: Preamble</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-an-example">Plotting: An Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-topics">Advanced Topics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-topic-cothreads">Advanced Topic: Cothreads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-cothread">Creating a Cothread</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#communicating-with-cothreads">Communicating with Cothreads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-using-event">Example: Using <code class="docutils literal notranslate"><span class="pre">Event</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cothread-suspension-points">Cothread Suspension Points</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cothreads-and-real-threads">Cothreads and Real Threads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slightly-more-realistic-version">Slightly more Realistic Version</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/DiamondLightSource/cothread/edit/ci_fixes/docs/user/training/cothread.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/user/training/cothread.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>